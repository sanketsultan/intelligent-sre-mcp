apiVersion: v1
kind: ServiceAccount
metadata:
  name: intelligent-sre-mcp
  namespace: intelligent-sre
  labels:
    app: intelligent-sre-mcp
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: intelligent-sre-mcp
  labels:
    app: intelligent-sre-mcp
rules:
# Read-only permissions for observability (also used for applying configurations)
- apiGroups: [""]
  resources:
  - pods
  - pods/log
  - services
  - endpoints
  - namespaces
  - events
  - configmaps
  - secrets
  verbs: ["get", "list", "watch", "create", "update", "patch"]

# Node operations (read + cordon/uncordon)
- apiGroups: [""]
  resources:
  - nodes
  verbs: ["get", "list", "watch", "patch", "update"]

# Pod healing operations (delete for restart, delete failed pods, create for testing, update for fixing)
- apiGroups: [""]
  resources:
  - pods
  verbs: ["create", "delete", "patch", "update"]

# Pod spec modifications (for applying fixes)
- apiGroups: [""]
  resources:
  - pods/ephemeralcontainers
  verbs: ["patch", "update"]

# Pod eviction (for drain/evict actions)
- apiGroups: ["policy"]
  resources:
  - pods/eviction
  verbs: ["create"]

# Deployment healing operations (scale, rollback, apply configurations)
- apiGroups: ["apps"]
  resources:
  - deployments
  - replicasets
  - statefulsets
  - daemonsets
  verbs: ["get", "list", "watch", "create", "patch", "update", "delete"]

# Deployment rollback operations
- apiGroups: ["apps"]
  resources:
  - deployments/rollback
  verbs: ["create"]

# Batch operations
- apiGroups: ["batch"]
  resources:
  - jobs
  - cronjobs
  verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: intelligent-sre-mcp
  labels:
    app: intelligent-sre-mcp
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: intelligent-sre-mcp
subjects:
- kind: ServiceAccount
  name: intelligent-sre-mcp
  namespace: intelligent-sre
